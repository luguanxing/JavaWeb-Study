# 拦截器

### Struts2拦截器概述
```
1 struts2是框架，封装了很多的功能，struts2里面封装的功能都是在拦截器里面
2 struts2里面封装了很多的功能，有很多拦截器，不是每次这些拦截器都执行，每次执行默认的拦截器
3 struts2里面默认拦截器位置
```

###  拦截器在什么时候执行？
```
  在action对象创建之后，action的方法执行之前
```

### 拦截器底层原理
```
1 拦截器底层使用两个原理
  第一个 aop思想
  （0）后面在spring里面把aop做更深层次分析
  （1）Aop是面向切面（方面）编程，有基本功能，扩展功能，不通过修改源代码方式扩展功能

  第二个 责任链模式
  （1）在java中有很多的设计模式，责任链模式是其中的一种
  （2）责任链模式和过滤链很相似的
  责任链模式：
   要执行多个操作，有添加、修改、删除三个操作。
  首先执行添加操作，添加操作执行之后 做类似于放行操作，执行修改操作，修改操作执行之后做类似于放行操作，执行删除操作
  过滤链：一个请求可有多个过滤器进行过滤，每个过滤器只有做放行才能到下一个过滤器
 
2 aop思想和责任链模式如何应用到拦截器里面？
  文字描述：
  - 拦截器在action对象创建之后，action的方法执行之前执行
  - 在action方法执行之前执行默认拦截器，执行过程使用aop思想，在action没有直接调用拦截器的方法，使用配置文件方式进行操作
  - 在执行拦截器时候，执行很多的拦截器，这个过程使用责任链模式
  -- 假如执行三个拦截器，执行拦截器1，执行拦截器1之后做放行操作，执行拦截器2，执行拦截器2之后做放行，执行拦截器3，执行拦截器3之后放行，执行action的方法

3 查看源代码
  （1）执行action
  （2）创建action对象，使用动态代理方式
  （3）执行action的方法
  （4）执行很多的拦截器，遍历执行
  类似于放行的操作的方法
```

### 重要的概念
```
1 过滤器和拦截器区别
（1）过滤器：过滤器理论上可以任意内容，比如html、jsp、servlet、图片路径
（2）拦截器：拦截器只可以拦截action
2 Servlet和action区别
（1）servlet默认第一次访问时候创建，创建一次，单实例对象
（2）action每次访问时候创建，创建多次，多实例对象
```

### 自定义拦截器
```
1 在struts2里面有很多的拦截器，这些拦截器是struts2封装的功能，但是在实际开发中，struts2里面的拦截器中可以没有要使用的功能，这个时候需要自己写拦截器实现功能
2 拦截器结构
（1）查看源代码看拦截器结构
- 继承类
在接口里面有三个方法
 ： 初始化操作
 ：销毁
 ：拦截逻辑的操作
 
（2）开发中，建议使用另外一种方式
- 写类，继承 MethodFilterInterceptor类实现
-- 让action里面某个的方法不进行拦截

（3）让拦截器和action有关系
- 不是在action调用拦截器的方法，而是通过配置文件方式让建立关系
```

### 自定义登录拦截器
```
1 需求：在项目中，有很多的action的超链接，实现只有是登录的状态，才可以点击action的超链接实现功能，
        如果不是登录状态，点击action超链接返回到登录页面

2 登录的状态：使用session域对象实现
（1）登录成功之后，把数据放到session里面
（2）判断session是否有值，可以知道是否是登录状态

3 实现登录的基本功能
（1）查询数据库判断用户名和密码（作业）

4 添加登录拦截器功能
（1）判断是否登录：判断session里面是否有名称是username的值
（2）拦截器实现过程
第一步 创建类，继承MethodFilterInterceptor类
第二步 重写MethodFilterInterceptor类里面的方法写拦截器逻辑
第三步 配置action和拦截器关系（注册拦截器）
（1）在要拦截的action标签所在的package标签里面声明拦截器
（2）在具体的action标签里面使用声明的拦截器
（3）struts2里面执行很多的默认拦截器，但是如果在action里面配置自定义拦截器，
问题：默认的拦截器不会执行了
解决：把默认拦截器手动使用一次

5配置拦截器，对action里面所有的方法都进行拦截
（1）在action里面有login的登录的方法，这个方法不需要拦截，如果这个方法都拦截，问题是，永远登录不进去了
（2）解决：让login方法不进行拦截
- 直接通过配置方式让action里面某些方法不进行拦截

6 如果登录状态，直接到功能页面，如果不是登录显示登陆页面
登录之后出现小问题：
（1）设置打开位置，在form标签里面
 ```
